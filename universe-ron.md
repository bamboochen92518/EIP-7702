---
timezone: UTC+8
---

> 请在上边的 timezone 添加你的当地时区(UTC)，这会有助于你的打卡状态的自动化更新，如果没有添加，默认为北京时间 UTC+8 时区


# 你的名字

嗨大家我是Univ，目前正在学习Web3领域知识，是我的荣幸可以跟大家一起学习，一起分享学习知识
你认为你会完成本次残酷学习吗？ 我会完成这次的共学
你的联系方式（推荐 Telegram）t.me/Univ

## Notes

<!-- Content_START -->

### 2025.05.14

# 1. 為什麼 EIP‑7702？

* **Pectra 硬分叉時間點**：官方預計 2025‑05‑07 上線。也就是說，再過不久，任何拿 MetaMask、Rainbow 之類「傳統 EOA」的朋友，都能瞬間獲得「智慧合約錢包級」的超能力。對開發者和使用者都是大新聞。  
* **我自己的痛點**：我在做一個包含 DEX + NFT 市場的小專案。現在最讓新人崩潰的流程是：  
  1. 第一次「Approve」鎖代幣（要付一次 gas）。  
  2. 第二次才「Transfer / Swap」（再付一次 gas）。  
  如果他們還沒存 ETH，就直接卡關。**7702** 把這些痛全部揉成一顆藥丸吞下去，一條龍搞定。  
* **錢包 UX 全面升級**：想像一下，你跟朋友吃飯，有個 DApp 說「我幫你付 gas，你只要按一次確認」。過去要靠 4337 或自家伺服器，門檻高；7702 出來，人人都能辦到。

---

# 2. 我眼中的三大亮點

| 亮點 | 白話翻譯 | 真的有什麼爽點？ |
|------|---------|-------------------|
| **批次交易 (Batching)** | 把「一次要做很多件事」打包成「一筆就搞定」。 | 少簽一次 = 少按一次 = 少一次搞錯的機會；gas 也省一大截。 |
| **交易贊助 (Sponsorship)** | 別人幫你出 gas，或用 USDC 之類代幣付費。 | 沒 ETH 也能玩連署、鑄 NFT、打 GameFi，門檻瞬間降到 0。 |
| **降權／會話金鑰 (Session Keys)** | 給 DApp 一把「只能花 500 塊、限 30 分鐘」的小鑰匙。 | 釣魚也只能咬到小額，提款機被裝護欄，安全感 up。 |

👉 重點：**7702 = 「臨時」把 EOA 的程式碼指向代理合約**。它不像 4337 得搞一大堆 Bundler、EntryPoint；只有在那一筆交易、那幾分鐘內生效，用完就收工，簡單粗暴。

---

# 3. 跟 ERC‑4337 是兄弟還是對手？

* 我覺得兩者是 **「大哥 + 小弟」** 的關係，不是你死我活。  
  * **ERC‑4337**：超完整、模組化、可擴充，像一台重裝機甲——功能強，部署重。  
  * **EIP‑7702**：輕量、即插即用，像袖珍瑞士刀——不一定能打大 Boss，但日常超好用。  
* 更棒的是，**Smart EOA**（開了 7702 超能力的地址）可以直接塞進 4337 的 `UserOperation` 當 sender。所以生態系不會破碎，大家繼續用熟悉的工具鏈。

---

# 4. 我最擔心／還沒解的問題

1. **私鑰還是單點失敗**  
   * 7702 幫你搞定「我忘記私鑰」→ 社交恢復；但「私鑰被盜」還是沒救。  
   * 後續要靠 EIP‑7851 那種「停用 / 重啟私鑰」功能才真正安全。  
2. **`tx.origin` 不再專屬最外層**  
   * 老智能合約用 `require(msg.sender == tx.origin)` 來防閃電貸、重入，現在可能被繞過。  
   * 必須快點跑一次審計，把舊程式碼掃過。  
3. **授權列表 UX 超關鍵**  
   * `authorization_list` 其實就是「把帳號大門鑰匙交給某段程式碼」。  
   * 如果錢包沒有做白名單、沒有顯示易懂警告，使用者簽一下就可能 GG。  
4. **節點 & 交易池 新麻煩**  
   * 一個 Smart EOA 可以在一筆交易裡狂呼多次 call，導致別人掛在 mempool 的交易瞬間失效。  
   * 節點端建議：對「已委派且 code 非空」的 EOA，一次只收一筆待處理。

---

# 5. 我準備怎麼用 7702？

* **前端**：  
  * 先偵測錢包是否支援 7702（簡單判 `eth_supportedTxTypes`）。  
  * 若支援，就把「Approve + Swap」合併成「一鍵 Swap」的 UX。  
* **後端（小型贊助服務）**：  
  * 幫用戶墊 gas，但收小額 USDC；跑一個簡易聲望 + 押金機制，避免白嫖。  
* **安全監控**：  
  * 把所有授權的目標地址拉進監控，看 code hash 是否在白名單；一旦有未知合約即時警告。

---

# 6. 接下來要觀察哪些指標？

1. 分叉後 **三個月**：  
   * 7702 交易量 vs. 4337 UserOp 的比例，如果後者還是大宗，就代表輕量需求沒那麼強烈。  
2. **錢包支援速度**：  
   * MetaMask、Rainbow、Safe、Keystone（硬體錢包）誰先搶頭香？  
3. **Hackathon 生態**：  
   * 會不會誕生「Session Key SDK」、「Gas Sponsorship API」這種新中介服務。  
4. **安全事件**：  
   * 有沒有人因亂簽 `authorization_list` 被洗光？那會是最血淋淋的教材。

---

# 7. 技術細節 & 成本解析（Rationale 大補帖）

## 7‑1 授權成本怎麼算？

| 動作 | Gas 估算 | 一句話解釋 |
|------|---------|-----------|
| 傳 101 bytes calldata | 1616 | 每非零 byte 乘 16 |
| `ecrecover` | 3000 | 標配恢復公鑰成本 |
| 讀 nonce + code | 2600 | 冷讀帳戶 |
| 暖帳戶 SSTORE | 200 | 已熱就便宜 |
| 部署 23 bytes 指示碼 | 4600 | 200 × 23 |
| **總計** | **≈ 12 016** → 四捨五入成 12 500 | 定義成 `PER_AUTH_BASE_COST` |

> 為什麼要四捨五入？作者說「還要算搬來搬去雜支」，索性加到吉祥數字 12 500。

## 7‑2 如何「洗掉」 delegation indicator？

* 把目標 address 設成 **0x0**。  
* 但第一次 call 還是要吃 2600 gas（冷讀 0x0 code），所以特別開後門：直接把 code hash 重設為空值，**真正回歸純 EOA**。

## 7‑3 不封鎖 Storage／Create 指令的理由

* 如果禁止 `SSTORE`，Smart EOA 會超難用，要另開外部倉庫合約，麻煩又慢。  
* 對開發者來說，一套錢包跑兩條路線（SC Wallet vs. EOA Wallet）＝ 地獄維護。統一才是王道。

## 7‑4 跨鏈安全：Chain ID 怎麼配？

* `chain_id = 0` → 不設防，全鏈都可用；  
* 指定值 → 只給那條鏈，像「國碼加手機號」一樣。  
* 有人提議「把 bytecode 也簽進去」，但要查鏈上 code，多一次資料庫 IO，傳播起來爆炸，就被否決。

## 7‑5 為何 `EXTCODE*` 不跳 Delegation？

* 假如會跳，壞人可把自己偽裝成 Uniswap Router 的 code hash，合約驗證邏輯全破。  
* 現在只讓 `CALL*` 等執行指令跳；`EXTCODE*` 還是乖乖回傳 0xef0100… 指示碼本身。

## 7‑6 Gas 先收後退：設計哲學

1. 檢查交易內在 gas → 直接用「最貴」算（假設帳戶是空的）。  
2. 真正處理 `authorization_list` 時，如果發現目標帳戶早就存在，就退你差額。  
3. 好處：**驗證速度快**，不需為每個 tuple 先查狀態再決定收多少。

## 7‑7 為何不把 Blob / Contract Creation 一併塞進來？

* **Blob（EIP‑4844）** 需要額外 P2P 邏輯，增加節點頻寬；  
* **合約建立** = 新增 `initcode` 執行分支，測試組超痛。  
* 對作者來說：「我們只想改善 UX，就別一次包山包海。」

## 7‑8 不讓 Delegation 指向 Precompile？

* Precompile 館裡面根本沒 code，執行跳進去也是空轉；  
* 與其搞例外處理，不如直接規定「指到 Precompile = 成功但啥也不做」。

## 7‑9 Mempool 攻略：一次只收一筆

* Smart EOA 一個交易可以掃光自己 balance，讓其他掛單全變廢單。  
* 節點守則：一個「已委派」的 EOA，在 mempool 只能有一張排隊票，不再讓它疊羅漢。

## 7‑10 安全 Tips

1. **Delegate 合約自己要很會保護**：  
   * Nonce 重放、防爆 gas、白名單目標合約… 缺一不可。  
2. **初始化前置搶跑**：  
   * 第一筆初始化 call 一定要 `ecrecover` 驗 EOA 簽名，別讓路人先搶設定。  
3. **Storage 遷移**：  
   * 用 ERC‑7201 slot 命名空間； or 先 `SSTORE` 清零再升級，確保不打架。  
4. **Sponsored 中繼者**：  
   * 先收押金／做信譽系統，免得被白嫖 gas。  

---

# 8. 整理

* 7702 像是給原本笨重的 EOA 加上「一次性外掛」。雖然不完美，但 win rate 超高。  
* 真要極致安全、玩模組化，4337 依舊是王道；7702 當成快速補丁，兩邊並行最好。  
* **行動呼籲**：  
  * 如果你是 DApp 前端：現在就開始在測試網打 `eth_sendTransaction(type: 0x04)`。  
  * 如果你做錢包：趕緊做 `authorization_list` 視覺化 + 白名單機制。  
  * 如果你是使用者：分叉之後先小額試水，不要一口氣把全部資產搬過去。

### 2025.05.15
### 2025.05.16
### 2025.05.17
### 2025.05.18
<!-- Content_END -->
